<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M E G Cafe, Gym & Carwash</title>
  <meta name="description" content="M E G Cafe, Gym & Carwash — makan enak, gym modern, dan layanan cuci mobil profesional." />
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Minimal reset + utility */
    :root{
      --primary:#2E6B41; /* green cafe */
      --accent:#F0A500;  /* warm accent */
      --muted:#6b6b6b;
      --bg:#ffffff;
      --card:#fbfbfb;
    }
    body{font-family:Inter, system-ui, Arial, sans-serif;margin:0;background:var(--bg);color:#222}
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
    header .brand{display:flex;gap:12px;align-items:center}
    header img.logo{height:48px}
    .btn{padding:10px 14px;border-radius:8px;background:var(--primary);color:#fff;border:none;cursor:pointer}
    /* HERO 70:30 */
    .hero{display:grid;grid-template-columns:70% 30%;gap:16px;align-items:center;margin-bottom:24px}
    .hero .left h1{font-size:28px;margin:0 0 8px}
    .hero .left p{color:var(--muted);margin:0 0 12px}
    .hero .right img{width:100%;height:260px;object-fit:cover;border-radius:12px}
    /* products */
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .search{flex:1;min-width:180px;padding:10px;border-radius:8px;border:1px solid #ddd}
    .filter{padding:10px;border-radius:8px;border:1px solid #ddd;background:#fff}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .card{display:flex;gap:12px;align-items:center;padding:12px;background:var(--card);border-radius:10px;box-shadow:0 1px 4px rgba(0,0,0,0.04)}
    .card img{width:120px;height:80px;object-fit:cover;border-radius:8px}
    .card .meta h4{margin:0 0 6px;font-size:16px}
    .price{font-weight:700}
    .price .old{text-decoration:line-through;color:#888;margin-left:8px;font-weight:400}
    /* packages */
    .packages{display:flex;gap:12px;flex-wrap:wrap;margin:18px 0}
    .pkg{flex:1;padding:12px;border-radius:10px;background:#fff;border:1px solid #eee}
    /* gallery slider basic */
    .gallery{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px}
    .gallery img{height:160px;border-radius:10px;object-fit:cover;margin-right:8px}
    /* responsive */
    @media (max-width:900px){
      .hero{grid-template-columns:1fr;gap:12px}
      .grid{grid-template-columns:repeat(2,1fr)}
      .hero .right img{height:200px}
    }
    @media (max-width:520px){
      .grid{grid-template-columns:1fr}
      header img.logo{height:38px}
      .hero .right img{height:160px}
    }
    /* floating WA button */
    .wa-float{position:fixed;right:18px;bottom:18px;background:#25D366;color:#fff;border-radius:50%;width:56px;height:56px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.2);z-index:999}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <img class="logo" src="logo.png" alt="MEG Cafe Logo">
        <div>
          <div style="font-weight:700">M E G</div>
          <div style="font-size:12px;color:var(--muted)">Cafe · Gym · Carwash</div>
        </div>
      </div>
      <nav>
        <a href="#menu">Menu</a> · <a href="#packages">Paket</a> · <a href="#gallery">Galeri</a> · <a href="#kontak">Kontak</a>
      </nav>
    </header>

    <!-- HERO 70:30 -->
    <section class="hero" id="hero">
      <div class="left">
        <h1 id="hero-title">Selamat datang di M E G Cafe</h1>
        <p id="hero-sub">Makanan lezat • Gym modern • Cuci mobil profesional</p>
        <div style="display:flex;gap:12px;margin-top:12px">
          <a class="btn" id="hero-btn">Pesan Sekarang</a>
          <a href="#menu" style="align-self:center;color:var(--primary)">Lihat Menu →</a>
        </div>
      </div>
      <div class="right">
        <img id="hero-image" src="hero-default.jpg" alt="Produk MEG">
      </div>
    </section>

    <!-- Controls -->
    <section id="menu">
      <h2>Menu Kami</h2>
      <div class="controls">
        <input id="search" class="search" placeholder="Cari menu, kategori, atau tag..." />
        <select id="categoryFilter" class="filter">
          <option value="">Semua Kategori</option>
        </select>
        <select id="sort" class="filter">
          <option value="name">Urut: Nama</option>
          <option value="price_asc">Harga: Rendah → Tinggi</option>
          <option value="price_desc">Harga: Tinggi → Rendah</option>
        </select>
      </div>

      <div id="productsGrid" class="grid">
        <!-- cards injected -->
      </div>
    </section>

    <!-- Packages -->
    <section id="packages" style="margin-top:22px">
      <h2>Paket Gym & Carwash</h2>
      <div id="packagesList" class="packages"></div>
    </section>

    <!-- Gallery -->
    <section id="gallery" style="margin-top:22px">
      <h2>Galeri</h2>
      <div id="gallerySlider" class="gallery"></div>
    </section>

    <!-- Youtube -->
    <section id="video" style="margin-top:22px">
      <h2>Video Kami</h2>
      <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px">
        <iframe id="ytframe" style="position:absolute;left:0;top:0;width:100%;height:100%;" src="" frameborder="0" allowfullscreen></iframe>
      </div>
    </section>

    <!-- Kelebihan -->
    <section id="features" style="margin-top:22px">
      <h2>Kelebihan Kami</h2>
      <ul>
        <li>Menu berbahan lokal dan sehat</li>
        <li>Gym lengkap & bersih, trainer profesional</li>
        <li>Proses cuci cepat dan hasil kinclong</li>
        <li>Booking online & pembayaran fleksibel</li>
      </ul>
    </section>

    <!-- Kontak -->
    <section id="kontak" style="margin-top:22px;margin-bottom:60px">
      <h2>Kontak & Lokasi</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div>
          <p id="address">Alamat: —</p>
          <p>Telp/WA: <a id="phoneLink" href="#">—</a></p>
          <p>Jam Operasional: 07:00 - 22:00</p>
        </div>
        <div id="mapEmbed">
          <!-- map iframe -->
        </div>
      </div>
    </section>

  </div>

  <!-- Floating WA button -->
  <a id="waFloat" class="wa-float" target="_blank" href="#">
    <svg width="24" height="24" viewBox="0 0 24 24"><path fill="white" d="M..."/></svg>
  </a>

  <script>
    // CONFIG
    const APPS_SCRIPT_BASE = 'https://script.google.com/macros/s/AKfycbydl4_bKwUdo37UVRoMUXpkEGuH3ymaybyFuDQZhpd-V4BhOTzkwhXMsyKha7ijZxGR/exec'; // replace with your web app URL
    const CACHE_TTL_MIN = 10; // cache in minutes

    // Simple cache using localStorage with timestamp
    function cacheFetch(key, url) {
      const raw = localStorage.getItem(key);
      if (raw) {
        try {
          const obj = JSON.parse(raw);
          const ageMin = (Date.now() - obj.t)/60000;
          if (ageMin < CACHE_TTL_MIN && obj.data) {
            return Promise.resolve(obj.data);
          }
        } catch(e){}
      }
      return fetch(url).then(r => r.json()).then(j => {
        if (j.ok) {
          localStorage.setItem(key, JSON.stringify({t:Date.now(), data:j.data}));
          return j.data;
        } else {
          return Promise.reject(j.error || 'fetch error');
        }
      });
    }

    async function init() {
      try {
        const [settings, slider, products, packages, gallery] = await Promise.all([
          cacheFetch('meg_settings', APPS_SCRIPT_BASE + '?path=settings'),
          cacheFetch('meg_slider', APPS_SCRIPT_BASE + '?path=slider'),
          cacheFetch('meg_products', APPS_SCRIPT_BASE + '?path=products'),
          cacheFetch('meg_packages', APPS_SCRIPT_BASE + '?path=packages'),
          cacheFetch('meg_gallery', APPS_SCRIPT_BASE + '?path=gallery'),
        ]);

        // apply settings
        if (settings) {
          if (settings.brand_color_primary) document.documentElement.style.setProperty('--primary', settings.brand_color_primary);
          if (settings.brand_color_accent) document.documentElement.style.setProperty('--accent', settings.brand_color_accent);
          if (settings.logo_url) document.querySelector('.logo').src = settings.logo_url;
          if (settings.phone_whatsapp) {
            const waHref = `https://wa.me/${settings.phone_whatsapp.replace(/\D/g,'')}`;
            document.getElementById('waFloat').href = waHref;
            document.getElementById('phoneLink').href = waHref;
            document.getElementById('phoneLink').textContent = settings.phone_whatsapp;
          }
          if (settings.google_maps_embed) {
            document.getElementById('mapEmbed').innerHTML = settings.google_maps_embed;
          }
          if (settings.youtube_embed) {
            document.getElementById('ytframe').src = settings.youtube_embed;
          }
          if (settings.business_address) document.getElementById('address').textContent = 'Alamat: ' + settings.business_address;
        }

        // hero
        if (slider && slider.length) {
          const s = slider[0];
          document.getElementById('hero-title').textContent = s.title || 'M E G Cafe';
          document.getElementById('hero-sub').textContent = s.subtitle || '';
          if (s.image_url) document.getElementById('hero-image').src = s.image_url;
          if (s.button_link) document.getElementById('hero-btn').onclick = () => window.location = s.button_link;
        }

        // products list
        window.APP_PRODUCTS = products || [];
        renderProducts(products || []);

        // fill categories
        const cats = new Set((products||[]).map(p => p.category).filter(Boolean));
        const sel = document.getElementById('categoryFilter');
        cats.forEach(c => {
          const opt = document.createElement('option'); opt.value = c; opt.textContent = c; sel.appendChild(opt);
        });

        // packages
        renderPackages(packages || []);

        // gallery
        renderGallery(gallery || []);

        // event handlers
        document.getElementById('search').addEventListener('input', debounce(e => applyFilter(), 250));
        document.getElementById('categoryFilter').addEventListener('change', e => applyFilter());
        document.getElementById('sort').addEventListener('change', e => applyFilter());

      } catch (err) {
        console.error('init error', err);
      }
    }

    function renderProducts(list) {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = '';
      // randomize or order? user wanted random: show shuffling
      const shuffled = shuffle(list.slice());
      shuffled.forEach(p => {
        const card = document.createElement('div'); card.className = 'card';
        card.innerHTML = `
          <img loading="lazy" src="${p.image_url || 'placeholder.jpg'}" alt="${p.name || ''}">
          <div class="meta">
            <h4>${p.name}</h4>
            <div style="color:var(--muted);font-size:13px">${p.description || ''}</div>
            <div style="margin-top:8px">
              <span class="price">${formatCurrency(p.price_discount || p.price_original)}</span>
              ${p.price_discount ? `<span class="old">${formatCurrency(p.price_original)}</span>` : ''}
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function renderPackages(list){
      const box = document.getElementById('packagesList');
      box.innerHTML = '';
      (list||[]).forEach(p => {
        const el = document.createElement('div'); el.className = 'pkg';
        el.innerHTML = `<h4>${p.name} <small style="color:var(--muted)">${p.type||''}</small></h4>
          <p style="color:var(--muted)">${p.description}</p>
          <div style="margin-top:8px;font-weight:700">${formatCurrency(p.price)}</div>`;
        box.appendChild(el);
      });
    }

    function renderGallery(list){
      const g = document.getElementById('gallerySlider');
      g.innerHTML = '';
      (list||[]).forEach(i => {
        const img = document.createElement('img');
        img.src = i.image_url;
        img.alt = i.caption || '';
        img.loading = 'lazy';
        g.appendChild(img);
      });
    }

    // FILTER + SEARCH
    function applyFilter(){
      const q = document.getElementById('search').value.trim().toLowerCase();
      const cat = document.getElementById('categoryFilter').value;
      const sort = document.getElementById('sort').value;
      let list = (window.APP_PRODUCTS || []).filter(p => {
        if (cat && p.category !== cat) return false;
        if (!q) return true;
        return (p.name + ' ' + (p.description||'') + ' ' + (p.tags||'')).toLowerCase().includes(q);
      });

      if (sort === 'price_asc') list.sort((a,b)=>(Number(a.price_discount||a.price_original)||0)-(Number(b.price_discount||b.price_original)||0));
      if (sort === 'price_desc') list.sort((a,b)=>(Number(b.price_discount||b.price_original)||0)-(Number(a.price_discount||a.price_original)||0));
      if (sort === 'name') list.sort((a,b)=> (a.name||'').localeCompare(b.name||''));
      renderProducts(list);
    }

    // helpers
    function formatCurrency(v){ if(!v) return ''; try{ return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR'}).format(Number(v)); }catch(e){ return v; } }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a }
    function debounce(fn, wait){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), wait); } }

    // initialize
    init();
  </script>
</body>
</html>
