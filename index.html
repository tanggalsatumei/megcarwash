<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MEG Carwash – Café • Carwash • Gym</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- HEADER -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto flex justify-between items-center p-4">
      <h1 class="text-2xl font-bold">MEG Carwash</h1>
      <nav class="space-x-4 hidden md:block">
        <a href="#menuCafe" class="hover:text-green-600">Café</a>
        <a href="#carwash" class="hover:text-green-600">Carwash</a>
        <a href="#gym" class="hover:text-green-600">Gym</a>
        <a href="#membership" class="hover:text-green-600">Membership</a>
        <a href="#booking" class="hover:text-green-600">Booking</a>
        <a href="#admin" class="hover:text-red-600">Admin</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="relative bg-cover bg-center h-[70vh]" style="background-image: url('https://i.ibb.co/jG2YQ8W/slider-cafe.jpg');">
    <div class="bg-black bg-opacity-50 h-full flex items-center justify-center">
      <div class="text-center text-white">
        <h2 class="text-4xl md:text-5xl font-bold mb-4">Café • Carwash • Gym</h2>
        <p class="text-lg mb-6">Semua dalam satu tempat – MEG Carwash</p>
        <a href="#booking" class="bg-green-600 px-6 py-3 rounded-lg text-white font-semibold hover:bg-green-700">Booking Sekarang</a>
      </div>
    </div>
  </section>

  <!-- MENU CAFE -->
  <section id="menuCafe" class="py-12 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Menu Café</h2>
      <div id="cafe-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </div>
  </section>

  <!-- CARWASH -->
  <section id="carwash" class="py-12">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Paket Carwash</h2>
      <div id="carwash-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </div>
  </section>

  <!-- GYM -->
  <section id="gym" class="py-12 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Paket Gym</h2>
      <div id="gym-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </div>
  </section>

  <!-- MEMBERSHIP -->
  <section id="membership" class="py-12">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-6">Cek Membership</h2>
      <input type="text" id="memberQuery" placeholder="Masukkan No. HP atau ID Member" class="border p-3 rounded w-full md:w-1/2 mb-4">
      <button onclick="findMember()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">Cek</button>
      <div id="member-result" class="mt-6 text-lg"></div>
    </div>
  </section>

  <!-- BOOKING -->
  <section id="booking" class="py-12 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Booking</h2>
      <form id="bookingForm" class="max-w-lg mx-auto bg-white p-6 rounded-xl shadow">
        <input type="text" name="nama" placeholder="Nama" class="border p-2 rounded w-full mb-3" required>
        <input type="text" name="hp" placeholder="No. HP" class="border p-2 rounded w-full mb-3" required>
        <select name="layanan" class="border p-2 rounded w-full mb-3" required>
          <option value="">Pilih Layanan</option>
          <option value="Carwash">Carwash</option>
          <option value="Gym">Gym</option>
        </select>
        <input type="date" name="tanggal" class="border p-2 rounded w-full mb-3" required>
        <input type="time" name="jam" class="border p-2 rounded w-full mb-3" required>
        <textarea name="catatan" placeholder="Catatan" class="border p-2 rounded w-full mb-3"></textarea>
        <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">Kirim Booking</button>
      </form>
      <div id="booking-result" class="mt-6 text-center"></div>
    </div>
  </section>

  <!-- ADMIN PANEL -->
  <section id="admin" class="py-12">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Admin Panel</h2>
      <div id="admin-login" class="text-center">
        <input type="password" id="admin-pin" placeholder="Masukkan PIN Admin" class="border p-2 rounded mb-4">
        <button onclick="adminLogin()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">Login</button>
      </div>
      <div id="admin-panel" class="hidden">
        <div class="mb-4">
          <select id="admin-sheet" class="border p-2 rounded">
            <option value="MenuCafe">Menu Café</option>
            <option value="PaketCarwash">Paket Carwash</option>
            <option value="PaketGym">Paket Gym</option>
          </select>
          <button onclick="loadAdminData()" class="ml-2 bg-green-600 text-white px-4 py-2 rounded">Load Data</button>
        </div>
        <div id="admin-table" class="overflow-x-auto mb-6"></div>
        <h3 class="text-xl font-bold mb-2">Tambah / Edit Data</h3>
        <form id="adminForm" class="bg-white p-4 rounded shadow space-y-3">
          <input type="hidden" id="admin-id">
          <input type="text" id="admin-nama" placeholder="Nama" class="border p-2 rounded w-full">
          <input type="text" id="admin-harga" placeholder="Harga" class="border p-2 rounded w-full">
          <input type="text" id="admin-hargaCoret" placeholder="Harga Coret" class="border p-2 rounded w-full">
          <input type="text" id="admin-deskripsi" placeholder="Deskripsi" class="border p-2 rounded w-full">
          <input type="text" id="admin-img" placeholder="Link Gambar (khusus Menu Café)" class="border p-2 rounded w-full">
          <div class="flex gap-2">
            <button type="button" onclick="saveData()" class="bg-blue-600 text-white px-4 py-2 rounded">Simpan</button>
            <button type="button" onclick="resetAdminForm()" class="bg-gray-400 text-white px-4 py-2 rounded">Reset</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-gray-800 text-white py-6 text-center">
    <p>&copy; 2025 MEG Carwash. All Rights Reserved.</p>
  </footer>

  <!-- SCRIPT -->
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbydl4_bKwUdo37UVRoMUXpkEGuH3ymaybyFuDQZhpd-V4BhOTzkwhXMsyKha7ijZxGR/exec";
    const API_TOKEN = "AKfycbydl4_bKwUdo37UVRoMUXpkEGuH3ymaybyFuDQZhpd-V4BhOTzkwhXMsyKha7ijZxGR";
    const ADMIN_PIN = "1234"; // PIN admin sederhana

    // --- FUNCTION PUBLIC (Cafe, Carwash, Gym, Member, Booking) --- 
    async function loadCafeMenu() {
      const res = await fetch(`${API_URL}?action=list&sheet=MenuCafe&token=${API_TOKEN}`);
      const data = await res.json();
      const list = document.getElementById("cafe-list");
      list.innerHTML = "";
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white shadow-lg rounded-xl overflow-hidden hover:shadow-xl transition";
        card.innerHTML = `
          <img src="${item.img || 'https://via.placeholder.com/400x250?text=No+Image'}" alt="${item.nama}" class="w-full h-48 object-cover">
          <div class="p-4">
            <h3 class="text-lg font-bold">${item.nama}</h3>
            <p class="text-sm text-gray-500 mb-2">${item.deskripsi || ''}</p>
            <div class="flex items-center justify-between">
              <span class="text-xl font-semibold text-green-600">Rp ${Number(item.harga).toLocaleString()}</span>
              ${item.hargaCoret ? `<span class="line-through text-gray-400">Rp ${Number(item.hargaCoret).toLocaleString()}</span>` : ""}
            </div>
          </div>
        `;
        list.appendChild(card);
      });
    }

    async function loadCarwash() {
      const res = await fetch(`${API_URL}?action=list&sheet=PaketCarwash&token=${API_TOKEN}`);
      const data = await res.json();
      const list = document.getElementById("carwash-list");
      list.innerHTML = "";
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded-xl shadow hover:shadow-lg transition";
        card.innerHTML = `
          <h3 class="text-lg font-bold">${item.nama}</h3>
          <p class="text-sm text-gray-500 mb-2">${item.deskripsi || ''}</p>
          <span class="text-xl font-semibold text-green-600">Rp ${Number(item.harga).toLocaleString()}</span>
          ${item.hargaCoret ? `<span class="line-through text-gray-400 ml-2">Rp ${Number(item.hargaCoret).toLocaleString()}</span>` : ""}
        `;
        list.appendChild(card);
      });
    }

    async function loadGym() {
      const res = await fetch(`${API_URL}?action=list&sheet=PaketGym&token=${API_TOKEN}`);
      const data = await res.json();
      const list = document.getElementById("gym-list");
      list.innerHTML = "";
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded-xl shadow hover:shadow-lg transition";
        card.innerHTML = `
          <h3 class="text-lg font-bold">${item.nama}</h3>
          <p class="text-sm text-gray-500 mb-2">${item.deskripsi || ''}</p>
          <span class="text-xl font-semibold text-green-600">Rp ${Number(item.harga).toLocaleString()}</span>
          ${item.hargaCoret ? `<span class="line-through text-gray-400 ml-2">Rp ${Number(item.hargaCoret).toLocaleString()}</span>` : ""}
        `;
        list.appendChild(card);
      });
    }

    async function findMember() {
      const q = document.getElementById("memberQuery").value.trim();
      if (!q) return;
      const res = await fetch(`${API_URL}?action=find.member&q=${q}&token=${API_TOKEN}`);
      const data = await res.json();
      const result = document.getElementById("member-result");
      if (data && data.nama) {
        result.innerHTML = `<p><strong>${data.nama}</strong> (${data.tier})<br> Berlaku sampai: ${data.berlaku_sampai}</p>`;
      } else {
        result.innerHTML = `<p class="text-red-600">Member tidak ditemukan</p>`;
      }
    }

    document.getElementById("bookingForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = Object.fromEntries(new FormData(form));
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "booking.create", sheet: "Bookings", token: API_TOKEN, data: formData })
      });
      const data = await res.json();
      document.getElementById("booking-result").innerHTML = data.success ? 
        "<p class='text-green-600'>Booking berhasil!</p>" : 
        "<p class='text-red-600'>Booking gagal!</p>";
      form.reset();
    });

    // --- ADMIN PANEL ---
    function adminLogin() {
      const pin = document.getElementById("admin-pin").value;
      if (pin === ADMIN_PIN) {
        document.getElementById("admin-login").classList.add("hidden");
        document.getElementById("admin-panel").classList.remove("hidden");
      } else {
        alert("PIN salah!");
      }
    }

    async function loadAdminData() {
      const sheet = document.getElementById("admin-sheet").value;
      const res = await fetch(`${API_URL}?action=list&sheet=${sheet}&token=${API_TOKEN}`);
      const data = await res.json();
      const tableDiv = document.getElementById("admin-table");
      let html = `<table class="min-w-full border"><thead><tr>`;
      if (data.length > 0) {
        Object.keys(data[0]).forEach(k => { html += `<th class="border px-2 py-1">${k}</th>`; });
        html += `<th class="border px-2 py-1">Aksi</th></tr></thead><tbody>`;
        data.forEach(row => {
          html += `<tr>`;
          Object.values(row).forEach(v => { html += `<td class="border px-2 py-1">${v}</td>`; });
          html += `<td class="border px-2 py-1">
            <button onclick='editData(${JSON.stringify(row)})' class="text-blue-600">Edit</button> | 
            <button onclick='deleteData("${sheet}","${row.id}")' class="text-red-600">Hapus</button>
          </td>`;
          html += `</tr>`;
        });
        html += `</tbody></table>`;
      } else {
        html = "<p>Belum ada data</p>";
      }
      tableDiv.innerHTML = html;
    }

    function editData(row) {
      document.getElementById("admin-id").value = row.id || "";
      document.getElementById("admin-nama").value = row.nama || "";
      document.getElementById("admin-harga").value = row.harga || "";
      document.getElementById("admin-hargaCoret").value = row.hargaCoret || "";
      document.getElementById("admin-deskripsi").value = row.deskripsi || "";
      document.getElementById("admin-img").value = row.img || "";
    }

    async function saveData() {
      const sheet = document.getElementById("admin-sheet").value;
      const id = document.getElementById("admin-id").value;
      const data = {
        nama: document.getElementById("admin-nama").value,
        harga: document.getElementById("admin-harga").value,
        hargaCoret: document.getElementById("admin-hargaCoret").value,
        deskripsi: document.getElementById("admin-deskripsi").value,
        img: document.getElementById("admin-img").value,
      };
      const action = id ? "update" : "create";
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action, sheet, token: API_TOKEN, id, data })
      });
      const result = await res.json();
      if (result.success) {
        alert("Data tersimpan");
        resetAdminForm();
        loadAdminData();
        loadCafeMenu(); loadCarwash(); loadGym();
      } else {
        alert("Gagal simpan");
      }
    }

    async function deleteData(sheet, id) {
      if (!confirm("Yakin hapus data ini?")) return;
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "delete", sheet, token: API_TOKEN, id })
      });
      const result = await res.json();
      if (result.success) {
        alert("Data terhapus");
        loadAdminData();
        loadCafeMenu(); loadCarwash(); loadGym();
      } else {
        alert("Gagal hapus");
      }
    }

    function resetAdminForm() {
      document.getElementById("admin-id").value = "";
      document.getElementById("adminForm").reset();
    }

    // INIT
    document.addEventListener("DOMContentLoaded", () => {
      loadCafeMenu();
      loadCarwash();
      loadGym();
    });
  </script>
</body>
</html>
