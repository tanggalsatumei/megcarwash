<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M E G Carwash, Cafe, & Gym</title>
  <meta name="description" content="M E G Carwash, Cafe, & Gym — makan enak, gym modern, dan layanan cuci mobil profesional." />

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
  <!-- GLightbox CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css"/>

  <style>
    :root{
      --primary:#2D4A7F;
      --accent:#F6B221;
      --dark:#1a1a1a;
      --muted:#6b6b6b;
      --bg:#ffffff;
      --card:#fbfbfb;
    }
    body{font-family:Inter, system-ui, Arial, sans-serif;margin:0;background:var(--bg);color:#222}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
    header .brand{display:flex;gap:12px;align-items:center}
    header img.logo{height:48px}
    nav a{margin:0 6px;color:var(--primary);font-weight:600}
    .btn{padding:10px 14px;border-radius:8px;background:var(--primary);color:#fff;border:none;cursor:pointer}
    .nav-links { display:flex; gap:16px; }
    .nav-links a { font-size:16px; font-weight:600; }
    .hamburger { display:none; flex-direction:column; cursor:pointer; gap:4px; }
    .hamburger span { width:28px; height:3px; background:var(--primary); border-radius:2px; }
    @media (max-width:768px){
      .nav-links {position:fixed; top:0; right:-100%;flex-direction:column; background:#fff;height:100%; width:250px; padding:60px 20px; transition:0.3s; box-shadow:-2px 0 10px rgba(0,0,0,0.1); z-index: 9999;}
      .nav-links.active { right:0; }
      .nav-links a { font-size:20px; margin:12px 0; }
      .hamburger { display:flex; }
      .close-btn {position:absolute; top:20px; right:20px; font-size:28px; cursor:pointer; color:var(--primary);}
    }
   
    .swiper-hero { width: 100%; border-radius: 12px; overflow: hidden; margin-bottom: 24px; position: relative; background-color: #e0f7ff;}
    .swiper-hero .swiper-slide { position: relative; display:grid; grid-template-columns:70% 30%; align-items:center; gap:20px; padding:0 30px; box-sizing:border-box;}
    .swiper-hero .left { color: #fff; z-index: 2; padding: 24px; text-shadow: 2px 2px 6px rgba(0,0,0,0.6);}
    .swiper-hero .left h1 { margin: 0; font-size: clamp(20px, 4vw, 36px); line-height: 1.2;}
    .swiper-hero .left p { margin: 8px 0 12px; font-size: clamp(14px, 2vw, 18px);}
    .swiper-hero .left button { padding: 10px 20px; font-size: clamp(12px, 1.5vw, 16px); background-color: #003366; color: #fff; border: none; border-radius: 8px;  cursor: pointer;}
    .swiper-hero .right img { position: relative; z-index: 2; width:100%; max-width:230px; aspect-ratio:1/1; object-fit:cover; border-radius:12px; padding: 24px;}
    .swiper-hero .bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.4; object-fit: cover;}
    @media (max-width: 768px) { .swiper-hero .swiper-slide { grid-template-columns: 1fr; text-align: center;}
      .swiper-hero .left { padding: 16px; }
      .swiper-hero .right { padding: 0; }
      .swiper-hero .right img { max-width: 200px; }
    }

    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .search{flex:1;min-width:180px;padding:10px;border-radius:8px;border:1px solid #ddd}
    .filter{padding:10px;border-radius:8px;border:1px solid #ddd;background:#fff}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .card{display:flex;gap:12px;align-items:center;padding:12px;background:var(--card);border-radius:10px;box-shadow:0 1px 4px rgba(0,0,0,0.04)}
    .card img{width:150px;aspect-ratio: 1/1;object-fit:cover;border-radius:8px;cursor:pointer}
    .card .meta h4{margin:0 0 6px;font-size:16px}
    .price{font-weight:700;color:var(--primary)}

    .packages{display:flex;gap:12px;flex-wrap:wrap;margin:18px 0}
    .pkg{flex:1;padding:12px;border-radius:10px;background:#fff;border:1px solid #eee}

    .gallery{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px}
    .gallery img { aspect-ratio: 3/4; height: auto; max-height: 260px; border-radius: 10px; cursor: pointer; transition: transform 0.3s; object-fit: cover;}
    .gallery img:hover { transform: scale(1.03);}

    .modal { display:none; position:fixed; z-index:3000; left:0;top:0;width:100%;height:100%; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; cursor: pointer;}
    .modal-content { max-width:90%; max-height:80%; border-radius:12px;}
    #modalCaption { margin-top:12px; text-align:center; color:#fff; font-size:14px;}
    .modal .close { position:absolute; top:20px;right:30px; font-size:36px; color:#fff; cursor:pointer;}
    .modal-body { display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-start; justify-content: center; cursor: default;}
    .modal-body img { max-width: 320px; width: 320px; aspect-ratio:1/1; border-radius: 12px; object-fit: cover;}
    .modal-text { max-width: 400px; color: #fff;}
    @media (max-width: 600px) {
      .modal-body { flex-direction: column; text-align: center; }
      .modal-body img { max-width: 90%; width: auto; }
      .modal-text { max-width: 90%; font-size: 14px; }
    }
    .modal .prev, .modal .next { position: absolute; top: 50%; transform: translateY(-50%); font-size: 40px; color: #fff; cursor: pointer; padding: 10px; user-select: none;}
    .modal .prev { left: 20px; }
    .modal .next { right: 20px; }

    .video-features{display:grid;grid-template-columns:70% 30%;gap:16px;align-items:flex-start}
    .video-features iframe{width:100%;height:315px;border-radius:12px}
    .features ul{margin:0;padding-left:20px}

    footer{background:var(--dark);color:#fff;width:100%;padding:40px 20px}
    .footer-inner{display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:1200px;margin:auto}
    .footer a{color:var(--accent)}
    .footer-copy{text-align:center;margin-top:20px;font-size:14px;opacity:0.8}
    @media(max-width:768px){.footer-inner{grid-template-columns:1fr}}
  
    @media (max-width:900px){
      .grid{grid-template-columns:repeat(2,1fr)}
      .video-features{grid-template-columns:1fr}
    }
    @media (max-width:520px){
      .grid{grid-template-columns:1fr}
      header img.logo{height:38px}
    }

    .wa-float{position:fixed;right:18px;bottom:18px;width:56px;height:56px;z-index:999}
    .wa-float img{width:100%;height:100%}

    .embed-responsive { position: relative; width: 100%; padding-bottom: 56.25%; height: 0;}
    .embed-responsive iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%;}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <img class="logo" src="https://res.cloudinary.com/da2vwj4bb/image/upload/v1757490344/Label_Kemasan_Meg_Coffee_5_x_5_cm_lytlcn.png" alt="M E G Carwash, Cafe, & Gym Logo">
        <div>
          <div style="font-weight:700">M E G</div>
          <div style="font-size:12px;color:var(--muted)">Carwash · Cafe · Gym</div>
        </div>
      </div>
      <nav>
        <div class="hamburger" onclick="toggleMenu()">
          <span></span><span></span><span></span>
        </div>
        <div class="nav-links" id="navLinks">
          <span class="close-btn" onclick="toggleMenu()">&times;</span>
          <a href="#menu">Menu</a>
          <a href="#packages">Paket</a>
          <a href="#gallery">Galeri</a>
          <a href="#kontak">Kontak</a>
        </div>
      </nav>
    </header>

    <!-- HERO Swiper -->
    <div class="swiper swiper-hero">
      <div class="swiper-wrapper" id="heroSlides"></div>
      <div class="swiper-pagination"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>

    <!-- Controls -->
    <section id="menu">
      <h2>Menu Kami</h2>
      <div class="controls">
        <input id="search" class="search" placeholder="Cari menu, kategori, atau tag..." />
        <select id="categoryFilter" class="filter">
          <option value="">Semua Kategori</option>
        </select>
        <select id="sort" class="filter">
          <option value="name">Urut: Nama</option>
          <option value="price_asc">Harga: Rendah → Tinggi</option>
          <option value="price_desc">Harga: Tinggi → Rendah</option>
        </select>
      </div>
      <div id="productsGrid" class="grid"></div>
    </section>

    <!-- Packages -->
    <section id="packages" style="margin-top:22px">
      <h2>Paket Gym & Carwash</h2>
      <div id="packagesList" class="packages"></div>
    </section>

    <section id="gallery" style="margin-top:22px">
      <h2>Galeri</h2>
      <div id="gallerySlider" class="gallery"></div>
    </section>

    <!-- Video + Features -->
    <section id="video" style="margin-top:22px">
      <h2>Video & Kelebihan Kami</h2>
      <div class="video-features">
        <div class="embed-responsive">
          <iframe src="https://www.youtube.com/embed/D7sZtkY8fdI?list=RDEM-QX_69oRWnAUPQuopwbmKg" frameborder="0" allowfullscreen></iframe>
        </div>

        <div class="features">
          <h3>Mengapa Kami</h3>
          <ul>
            <li>Menu berbahan lokal dan sehat</li>
            <li>Gym lengkap & bersih, trainer profesional</li>
            <li>Proses cuci cepat dan hasil kinclong</li>
            <li>Booking online & pembayaran fleksibel</li>
          </ul>
        </div>
      </div>
    </section>
  </div>

    <!-- Floating WA button -->
  <a id="waFloat" class="wa-float" target="_blank" href="#">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
  </a>

  <!-- Footer outside container -->
  <footer id="kontak">
    <div class="footer-inner">
      <div>
        <h3>Kontak Kami</h3>
        <p id="address"></p>
        <p>Telp/WA: <a id="phoneLink" href="#"></a></p>
        <p>Jam Operasional: <span id="openHours"></span></p>
        <p>Hari Operasional: <span id="openDays"></span></p>
      </div>
      <div class="embed-responsive" style="width:auto;"><iframe id="mapEmbed" src="" allowfullscreen loading="lazy"></iframe></div>
    </div>
    <p class="footer-copy">© 2025 M E G Cafe · Gym · Carwash</p>
  </footer>

  <!-- Modal Produk -->
  <div id="productModal" class="modal">
    <span class="close" onclick="closeProductModal()">&times;</span>
    <div class="modal-body">
      <img id="productModalImg" src="" alt="">
      <div class="modal-text">
        <h3 id="productModalTitle"></h3>
        <p id="productModalDesc"></p>
        <p id="productModalPrice"></p>
      </div>
    </div>
  </div>

  <!-- Modal Galeri -->
  <div id="galleryModal" class="modal">
    <span class="close" onclick="closeGalleryModal()">&times;</span>
    <span class="prev" onclick="changeSlide(-1)">&#10094;</span>
    <span class="next" onclick="changeSlide(1)">&#10095;</span>
    <div class="modal-body">
      <img id="galleryModalImg" src="" alt="">
      <div class="modal-text">
        <p id="galleryModalCaption"></p>
      </div>
    </div>
  </div>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <!-- GLightbox JS -->
  <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

  <script>
    const APPS_SCRIPT_BASE = 'https://script.google.com/macros/s/AKfycbyA-J8A83fhg2hHCmoGZ6bvVSw5RHfbzy2Rs--rg-QEMpHvjbbuBj23HoKWz3Cf7Y5B/exec';
    const CACHE_TTL_MIN = 10;

    function cacheFetch(key, url) {
      const raw = localStorage.getItem(key);
      if (raw) {
        try {
          const obj = JSON.parse(raw);
          const ageMin = (Date.now() - obj.t)/60000;
          if (ageMin < CACHE_TTL_MIN && obj.data) return Promise.resolve(obj.data);
        } catch(e){}
      }
      return fetch(url).then(r => r.json()).then(j => {
        if (j.ok) {
          localStorage.setItem(key, JSON.stringify({t:Date.now(), data:j.data}));
          return j.data;
        } else return Promise.reject(j.error || 'fetch error');
      });
    }

    async function init() {
      try {
        const [settings, slider, products, packages, gallery] = await Promise.all([
          cacheFetch('meg_settings', APPS_SCRIPT_BASE + '?path=settings'),
          cacheFetch('meg_slider', APPS_SCRIPT_BASE + '?path=slider'),
          cacheFetch('meg_products', APPS_SCRIPT_BASE + '?path=products'),
          cacheFetch('meg_packages', APPS_SCRIPT_BASE + '?path=packages'),
          cacheFetch('meg_gallery', APPS_SCRIPT_BASE + '?path=gallery'),
        ]);

        if (settings) {
          if (settings.brand_color_primary) {
            document.documentElement.style.setProperty('--primary', settings.brand_color_primary);
          }
          if (settings.brand_color_accent) {
            document.documentElement.style.setProperty('--accent', settings.brand_color_accent);
          }
          if (settings.brand_color_dark) {
            document.documentElement.style.setProperty('--dark', settings.brand_color_dark);
          }
          if (settings.brand_color_muted) {
            document.documentElement.style.setProperty('--muted', settings.brand_color_muted);
          }
          if (settings.bg_color) {
            document.documentElement.style.setProperty('--bg', settings.bg_color);
          }
          if (settings.card_color) {
            document.documentElement.style.setProperty('--card', settings.card_color);
          }

          if (settings.logo_url) document.querySelector('.logo').src = settings.logo_url;
          if (settings.phone_whatsapp) {
            const waHref = `https://wa.me/${settings.phone_whatsapp.replace(/\D/g,'')}`;
            document.getElementById('waFloat').href = waHref;
            document.getElementById('phoneLink').href = waHref;
            document.getElementById('phoneLink').textContent = settings.phone_whatsapp;
          }
          if (settings.google_maps_embed) {
            document.getElementById('mapEmbed').src = settings.google_maps_embed;
          } else {
            // fallback jika tidak ada di spreadsheet
            document.getElementById('mapEmbed').src = `<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1992.352141501076!2d112.3998654504567!3d-7.124982324081749!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e77f7df461e2a43%3A0x126fa1043952a986!2sMEG%20CARWASH%2C%20GYM%20AND%20CAFE!5e1!3m2!1sen!2sid!4v1756956511661!5m2!1sen!2sid" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
          }
          if (settings.youtube_embed) {
            let yurl = settings.youtube_embed;
            if (yurl.includes("watch?v=")) {
              // konversi watch?v= ke embed/
              const videoId = yurl.split("watch?v=")[1].split("&")[0];
              const listId = yurl.includes("list=") ? yurl.split("list=")[1].split("&")[0] : "";
              yurl = `https://www.youtube.com/embed/${videoId}${listId ? `?list=${listId}` : ""}`;
            }
            document.getElementById('ytframe').src = yurl;
          }

          if (settings.business_address) document.getElementById('address').textContent = 'Alamat: ' + settings.business_address;
          if (settings.opening_hours) document.getElementById('openHours').textContent = settings.opening_hours;
          if (settings.opening_days) document.getElementById('openDays').textContent = settings.opening_days;
        }

        // hero slider
        const heroBox = document.getElementById('heroSlides');
        (slider||[]).forEach(s => {
          const slide = document.createElement('div'); 
          slide.className = 'swiper-slide relative';
          slide.innerHTML = `
            <div class="left">
              <h1>${s.title||''}</h1>
              <p>${s.subtitle||''}</p>
              ${s.button_link ? `<a href="${s.button_link}" class="btn">${s.button_text||'Pesan Sekarang'}</a>` : ''}
            </div>
            <div class="right">
              ${s.image_url ? `<img src="${s.image_url}" alt="${s.title||''}">` : ''}
            </div>
            ${s.bg_image ? `<img src="${s.bg_image}" class="bg">` : `<div class="bg" style="background:${s.bg_color||'var(--primary)'}"></div>`}
          `;
          heroBox.appendChild(slide);
        });
        new Swiper(".swiper-hero", {
          loop:true,
          autoplay:{delay:4000},
          pagination:{el:".swiper-pagination", clickable:true},
          navigation:{nextEl:".swiper-button-next", prevEl:".swiper-button-prev"},
        });

        // products
        window.APP_PRODUCTS = products||[];
        renderProducts(products||[]);
        const cats = new Set((products||[]).map(p => p.category).filter(Boolean));
        const sel = document.getElementById('categoryFilter');
        cats.forEach(c => { const opt=document.createElement('option');opt.value=c;opt.textContent=c;sel.appendChild(opt); });

        // packages
        renderPackages(packages||[]);
        // gallery
        renderGallery(gallery||[]);
        

        // filter events
        document.getElementById('search').addEventListener('input', debounce(e=>applyFilter(),250));
        document.getElementById('categoryFilter').addEventListener('change', e=>applyFilter());
        document.getElementById('sort').addEventListener('change', e=>applyFilter());

        GLightbox({selector:'.glightbox'});
      } catch(err){ console.error('init error',err); }
    }

    function toggleMenu(){
      document.getElementById("navLinks").classList.toggle("active");
    }

    function renderProducts(list) {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = '';
      const shuffled = shuffle(list.slice());
      shuffled.forEach(p => {
        const card = document.createElement('div'); 
        card.className = 'card';
        card.innerHTML = `
          <img loading="lazy" src="${p.image_url || 'placeholder.jpg'}" alt="${p.name || ''}">
          <div class="meta">
            <h4>${p.name}</h4>
            <div style="color:var(--muted);font-size:13px">${p.description || ''}</div>
            <div style="margin-top:8px">
              <span class="price">${formatCurrency(p.price_original)}</span>
            </div>
          </div>
        `;
        // klik untuk buka modal
        card.querySelector("img").onclick = () => openProductModal(p);
        grid.appendChild(card);
      });
    }

    function shuffle(array) {
      let currentIndex = array.length, randomIndex;
      while (currentIndex !== 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
      }
      return array;
    }

    function openProductModal(product){
      document.getElementById('productModal').style.display = 'flex';
      document.getElementById('productModalImg').src = product.image_url;
      document.getElementById('productModalTitle').textContent = product.name;
      document.getElementById('productModalDesc').textContent = product.description;
      document.getElementById('productModalPrice').textContent = formatCurrency(product.price_original);
    }
    function closeProductModal(){
      document.getElementById('productModal').style.display = 'none';
    }

    function renderPackages(list){
      const box=document.getElementById('packagesList'); box.innerHTML='';
      (list||[]).forEach(p=>{
        const el=document.createElement('div');el.className='pkg';
        el.innerHTML=`<h4>${p.name} <small style="color:var(--muted)">${p.type||''}</small></h4>
          <p style="color:var(--muted)">${p.description||''}</p>
          <div style="margin-top:8px;font-weight:700">${formatCurrency(p.price)}</div>`;
        box.appendChild(el);
      });
    }

    let galleryIndex = 0;
    let galleryList = [];
    
    function renderGallery(list){
      const g = document.getElementById('gallerySlider');
      g.innerHTML = '';
      galleryList = list || [];
      galleryList.forEach((i, idx) => {
        const img = document.createElement('img');
        img.src = i.image_url;
        img.alt = i.caption || '';
        img.loading = 'lazy';
        img.onclick = () => openGalleryModal(idx);
        g.appendChild(img);
      });
    }
    
    function openGalleryModal(index){
      galleryIndex = index;
      const item = galleryList[galleryIndex];
      document.getElementById('galleryModal').style.display = 'flex';
      document.getElementById('galleryModalImg').src = item.image_url;
      document.getElementById('galleryModalCaption').textContent = item.caption || '';
    }
    
    function closeGalleryModal(){
      document.getElementById('galleryModal').style.display = 'none';
    }
    
    function changeSlide(step){
      galleryIndex += step;
      if (galleryIndex < 0) galleryIndex = galleryList.length - 1;
      if (galleryIndex >= galleryList.length) galleryIndex = 0;
      openGalleryModal(galleryIndex);
    }
    
    function openModal(src, caption){
      document.getElementById('galleryModal').style.display = 'flex';
      document.getElementById('modalImg').src = src;
      document.getElementById('modalCaption').textContent = caption || '';
    }
    function closeModal(){
      document.getElementById('galleryModal').style.display = 'none';
    }

    window.addEventListener("click",function(e){
      document.querySelectorAll(".modal").forEach(m=>{if(e.target===m)m.style.display="none";});
    });

    document.addEventListener('DOMContentLoaded',init);

    function applyFilter(){
      const q=document.getElementById('search').value.trim().toLowerCase();
      const cat=document.getElementById('categoryFilter').value;
      const sort=document.getElementById('sort').value;
      let list=(window.APP_PRODUCTS||[]).filter(p=>{
        if(cat&&p.category!==cat) return false;
        if(!q) return true;
        return (p.name+' '+(p.description||'')+' '+(p.tags||'')).toLowerCase().includes(q);
      });
      if(sort==='price_asc') list.sort((a,b)=>(Number(a.price_original)||0)-(Number(b.price_original)||0));
      if(sort==='price_desc') list.sort((a,b)=>(Number(b.price_original)||0)-(Number(a.price_original)||0));
      if(sort==='name') list.sort((a,b)=>(a.name||'').localeCompare(b.name||''));
      renderProducts(list);
    }

    function formatCurrency(v){ if(!v) return ''; try{ return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR'}).format(Number(v)); }catch(e){ return v; } }
    function debounce(fn, wait){ let t; return(...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args),wait);} }
    init();
  </script>
</body>
</html>
