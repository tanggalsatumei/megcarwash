<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MEG Carwash – Café • Carwash • Gym</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- HEADER -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto flex justify-between items-center p-4">
      <h1 class="text-2xl font-bold">MEG Carwash</h1>
      <nav class="space-x-4 hidden md:block">
        <a href="#menuCafe" class="hover:text-green-600">Café</a>
        <a href="#carwash" class="hover:text-green-600">Carwash</a>
        <a href="#gym" class="hover:text-green-600">Gym</a>
        <a href="#membership" class="hover:text-green-600">Membership</a>
        <a href="#booking" class="hover:text-green-600">Booking</a>
        <a href="#admin" class="hover:text-green-600">Admin</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="relative bg-cover bg-center h-[70vh]" style="background-image: url('https://via.placeholder.com/1200x600?text=MEG+Carwash+Cafe+Gym');">
    <div class="bg-black bg-opacity-50 h-full flex items-center justify-center">
      <div class="text-center text-white">
        <h2 class="text-4xl md:text-5xl font-bold mb-4">Café • Carwash • Gym</h2>
        <p class="text-lg mb-6">Semua dalam satu tempat – MEG Carwash</p>
        <a href="#booking" class="bg-green-600 px-6 py-3 rounded-lg text-white font-semibold hover:bg-green-700">Booking Sekarang</a>
      </div>
    </div>
  </section>

  <!-- MENU CAFE -->
  <section id="menuCafe" class="py-12 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Menu Café</h2>
      <div id="cafe-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </div>
  </section>

  <!-- CARWASH -->
  <section id="carwash" class="py-12">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Paket Carwash</h2>
      <div id="carwash-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </div>
  </section>

  <!-- GYM -->
  <section id="gym" class="py-12 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Paket Gym</h2>
      <div id="gym-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </div>
  </section>

  <!-- MEMBERSHIP -->
  <section id="membership" class="py-12">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-6">Cek Membership</h2>
      <input type="text" id="memberQuery" placeholder="Masukkan No. HP atau ID Member" class="border p-3 rounded w-full md:w-1/2 mb-4">
      <button onclick="findMember()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">Cek</button>
      <div id="member-result" class="mt-6 text-lg"></div>
    </div>
  </section>

  <!-- BOOKING -->
  <section id="booking" class="py-12 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Booking</h2>
      <form id="bookingForm" class="max-w-lg mx-auto bg-white p-6 rounded-xl shadow">
        <input type="text" name="nama" placeholder="Nama" class="border p-2 rounded w-full mb-3" required>
        <input type="text" name="hp" placeholder="No. HP" class="border p-2 rounded w-full mb-3" required>
        <select name="layanan" class="border p-2 rounded w-full mb-3" required>
          <option value="">Pilih Layanan</option>
          <option value="Carwash">Carwash</option>
          <option value="Gym">Gym</option>
        </select>
        <input type="date" name="tanggal" class="border p-2 rounded w-full mb-3" required>
        <input type="time" name="jam" class="border p-2 rounded w-full mb-3" required>
        <textarea name="catatan" placeholder="Catatan" class="border p-2 rounded w-full mb-3"></textarea>
        <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">Kirim Booking</button>
      </form>
      <div id="booking-result" class="mt-6 text-center"></div>
    </div>
  </section>

  <!-- ADMIN PANEL -->
  <section id="admin" class="py-12 bg-gray-100">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-6 text-center">Admin Panel</h2>

      <!-- Login -->
      <div id="admin-login" class="text-center">
        <input type="password" id="admin-pin" placeholder="Masukkan PIN" class="border p-2 rounded mb-4">
        <button onclick="adminLogin()" class="bg-blue-600 text-white px-4 py-2 rounded">Login</button>
      </div>

      <!-- Dashboard -->
      <div id="admin-dashboard" class="hidden">
        <h3 class="text-xl font-bold mb-4">CRUD Menu Café</h3>
        <form id="adminForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <input type="hidden" id="admin-id">
          <input type="text" id="admin-nama" placeholder="Nama Produk" class="border p-2 rounded" required>
          <input type="number" id="admin-harga" placeholder="Harga" class="border p-2 rounded" required>
          <input type="number" id="admin-hargaCoret" placeholder="Harga Coret" class="border p-2 rounded">
          <input type="text" id="admin-img" placeholder="URL Gambar" class="border p-2 rounded">
          <textarea id="admin-deskripsi" placeholder="Deskripsi" class="border p-2 rounded col-span-2"></textarea>
          <div class="col-span-2 flex gap-2">
            <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">Simpan</button>
            <button type="button" onclick="resetForm()" class="bg-gray-500 text-white px-4 py-2 rounded">Reset</button>
          </div>
        </form>
        <div id="admin-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-gray-800 text-white py-6 text-center">
    <p>&copy; 2025 MEG Carwash. All Rights Reserved.</p>
  </footer>

  <!-- SCRIPT -->
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbydl4_bKwUdo37UVRoMUXpkEGuH3ymaybyFuDQZhpd-V4BhOTzkwhXMsyKha7ijZxGR/exec"; // ganti dengan URL Apps Script
    const API_TOKEN = "AKfycbydl4_bKwUdo37UVRoMUXpkEGuH3ymaybyFuDQZhpd-V4BhOTzkwhXMsyKha7ijZxGR"; // samakan dengan Apps Script TOKEN
    const ADMIN_PIN = "1234"; // PIN login admin

    // Helper Fetch dengan Error Handling
    async function fetchJSONSafe(url, options = {}) {
      try {
        const res = await fetch(url, options);
        if (!res.ok) throw new Error("HTTP Error " + res.status);
        const text = await res.text();
        try {
          return JSON.parse(text);
        } catch {
          throw new Error(text);
        }
      } catch (err) {
        console.error("API Error:", err.message);
        return { error: true, message: err.message };
      }
    }

    // Load Café Menu
    async function loadCafeMenu() {
      const data = await fetchJSONSafe(`${API_URL}?action=list&sheet=MenuCafe&token=${API_TOKEN}`);
      const list = document.getElementById("cafe-list");
      list.innerHTML = "";
      if (data.error) {
        list.innerHTML = `<p class="text-red-600">${data.message}</p>`;
        return;
      }
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white shadow-lg rounded-xl overflow-hidden hover:shadow-xl transition";
        card.innerHTML = `
          <img src="${item.img || 'https://via.placeholder.com/400x250?text=No+Image'}" alt="${item.nama}" class="w-full h-48 object-cover">
          <div class="p-4">
            <h3 class="text-lg font-bold">${item.nama}</h3>
            <p class="text-sm text-gray-500 mb-2">${item.deskripsi || ''}</p>
            <span class="text-xl font-semibold text-green-600">Rp ${Number(item.harga).toLocaleString()}</span>
          </div>
        `;
        list.appendChild(card);
      });
    }

    // Carwash
    async function loadCarwash() {
      const data = await fetchJSONSafe(`${API_URL}?action=list&sheet=PaketCarwash&token=${API_TOKEN}`);
      const list = document.getElementById("carwash-list");
      list.innerHTML = "";
      if (data.error) {
        list.innerHTML = `<p class="text-red-600">${data.message}</p>`;
        return;
      }
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded-xl shadow hover:shadow-lg transition";
        card.innerHTML = `
          <h3 class="text-lg font-bold">${item.nama}</h3>
          <p class="text-sm text-gray-500 mb-2">${item.deskripsi || ''}</p>
          <span class="text-xl font-semibold text-green-600">Rp ${Number(item.harga).toLocaleString()}</span>
        `;
        list.appendChild(card);
      });
    }

    // Gym
    async function loadGym() {
      const data = await fetchJSONSafe(`${API_URL}?action=list&sheet=PaketGym&token=${API_TOKEN}`);
      const list = document.getElementById("gym-list");
      list.innerHTML = "";
      if (data.error) {
        list.innerHTML = `<p class="text-red-600">${data.message}</p>`;
        return;
      }
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded-xl shadow hover:shadow-lg transition";
        card.innerHTML = `
          <h3 class="text-lg font-bold">${item.nama}</h3>
          <p class="text-sm text-gray-500 mb-2">${item.deskripsi || ''}</p>
          <span class="text-xl font-semibold text-green-600">Rp ${Number(item.harga).toLocaleString()}</span>
        `;
        list.appendChild(card);
      });
    }

    // Membership
    async function findMember() {
      const q = document.getElementById("memberQuery").value.trim();
      if (!q) return;
      const data = await fetchJSONSafe(`${API_URL}?action=find.member&q=${q}&token=${API_TOKEN}`);
      const result = document.getElementById("member-result");
      if (data && data.nama) {
        result.innerHTML = `<p><strong>${data.nama}</strong> (${data.tier})<br>Berlaku sampai: ${data.berlaku_sampai}</p>`;
      } else {
        result.innerHTML = `<p class="text-red-600">Member tidak ditemukan</p>`;
      }
    }

    // Booking
    document.getElementById("bookingForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = Object.fromEntries(new FormData(form));
      const data = await fetchJSONSafe(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "booking.create", sheet: "Bookings", token: API_TOKEN, data: formData })
      });
      document.getElementById("booking-result").innerHTML = data.success ? 
        "<p class='text-green-600'>Booking berhasil!</p>" : 
        "<p class='text-red-600'>Booking gagal!</p>";
      form.reset();
    });

    // Admin
    function adminLogin() {
      const pin = document.getElementById("admin-pin").value;
      if (pin === ADMIN_PIN) {
        document.getElementById("admin-login").classList.add("hidden");
        document.getElementById("admin-dashboard").classList.remove("hidden");
        loadAdminList();
      } else {
        alert("PIN salah!");
      }
    }

    async function loadAdminList() {
      const data = await fetchJSONSafe(`${API_URL}?action=list&sheet=MenuCafe&token=${API_TOKEN}`);
      const list = document.getElementById("admin-list");
      list.innerHTML = "";
      if (data.error) {
        list.innerHTML = `<p class="text-red-600">${data.message}</p>`;
        return;
      }
      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded shadow flex justify-between";
        card.innerHTML = `
          <div>
            <h4 class="font-bold">${item.nama}</h4>
            <p>Rp ${Number(item.harga).toLocaleString()}</p>
          </div>
          <div class="flex gap-2">
            <button onclick='editItem(${JSON.stringify(item)})' class="bg-blue-500 text-white px-2 rounded">Edit</button>
            <button onclick='deleteItem("${item.id}")' class="bg-red-500 text-white px-2 rounded">Hapus</button>
          </div>
        `;
        list.appendChild(card);
      });
    }

    document.getElementById("adminForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("admin-id").value;
      const data = {
        nama: document.getElementById("admin-nama").value,
        harga: document.getElementById("admin-harga").value,
        hargaCoret: document.getElementById("admin-hargaCoret").value,
        img: document.getElementById("admin-img").value,
        deskripsi: document.getElementById("admin-deskripsi").value
      };
      const action = id ? "update" : "create";
      const payload = { action, sheet: "MenuCafe", token: API_TOKEN, data, id };
      await fetchJSONSafe(API_URL, { method: "POST", body: JSON.stringify(payload) });
      resetForm();
      loadAdminList();
      loadCafeMenu();
    });

    async function deleteItem(id) {
      if (!confirm("Yakin hapus?")) return;
      await fetchJSONSafe(API_URL, { method: "POST", body: JSON.stringify({ action: "delete", sheet: "MenuCafe", token: API_TOKEN, id }) });
      loadAdminList();
      loadCafeMenu();
    }

    function editItem(item) {
      document.getElementById("admin-id").value = item.id;
      document.getElementById("admin-nama").value = item.nama;
      document.getElementById("admin-harga").value = item.harga;
      document.getElementById("admin-hargaCoret").value = item.hargaCoret || "";
      document.getElementById("admin-img").value = item.img || "";
      document.getElementById("admin-deskripsi").value = item.deskripsi || "";
    }

    function resetForm() {
      document.getElementById("admin-id").value = "";
      document.getElementById("adminForm").reset();
    }

    // Init
    document.addEventListener("DOMContentLoaded", () => {
      loadCafeMenu();
      loadCarwash();
      loadGym();
    });
  </script>
</body>
</html>
