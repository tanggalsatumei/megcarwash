<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M E G Cafe, Gym & Carwash</title>
  <meta name="description" content="M E G Cafe, Gym & Carwash — makan enak, gym modern, dan layanan cuci mobil profesional." />

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
  <!-- GLightbox CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css"/>

  <style>
    :root{
      --primary:#2D4A7F;
      --accent:#F6B221;
      --dark:#1a1a1a;
      --muted:#6b6b6b;
      --bg:#ffffff;
      --card:#fbfbfb;
    }
    body{font-family:Inter, system-ui, Arial, sans-serif;margin:0;background:var(--bg);color:#222}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
    header .brand{display:flex;gap:12px;align-items:center}
    header img.logo{height:48px}
    nav a{margin:0 6px;color:var(--primary);font-weight:600}
    .btn{padding:10px 14px;border-radius:8px;background:var(--primary);color:#fff;border:none;cursor:pointer}

   /* Slide Layout */
.swiper-hero .swiper-slide {
  display: grid;
  grid-template-columns: 30% 70%;
  align-items: center;
  padding: 20px;
  gap: 20px;
}

/* Kiri: Gambar */
.swiper-hero .left {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
}

.swiper-hero .left img {
  width: 100%;
  aspect-ratio: 1 / 1;
  object-fit: cover;
  border-radius: 12px;
}

/* Kanan: Teks */
.swiper-hero .right {
  color: #003366;
  z-index: 2;
  padding: 24px;
}

.swiper-hero .right h1 {
  margin: 0;
  font-size: clamp(20px, 4vw, 36px);
  line-height: 1.2;
}

.swiper-hero .right p {
  margin: 8px 0 12px;
  font-size: clamp(14px, 2vw, 18px);
}

.swiper-hero .right button {
  padding: 10px 20px;
  font-size: clamp(12px, 1.5vw, 16px);
  background-color: #003366;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

/* Responsif Mobile */
@media (max-width: 768px) {
  .swiper-hero .swiper-slide {
    grid-template-columns: 1fr;
    text-align: center;
  }

  .swiper-hero .left img {
    max-width: 200px;
  }

  .swiper-hero .right {
    padding: 16px;
  }
}

    /* Controls + grid */
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .search{flex:1;min-width:180px;padding:10px;border-radius:8px;border:1px solid #ddd}
    .filter{padding:10px;border-radius:8px;border:1px solid #ddd;background:#fff}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .card{display:flex;gap:12px;align-items:center;padding:12px;background:var(--card);border-radius:10px;box-shadow:0 1px 4px rgba(0,0,0,0.04)}
    .card img{width:120px;height:80px;object-fit:cover;border-radius:8px;cursor:pointer}
    .card .meta h4{margin:0 0 6px;font-size:16px}
    .price{font-weight:700;color:var(--primary)}

    /* packages */
    .packages{display:flex;gap:12px;flex-wrap:wrap;margin:18px 0}
    .pkg{flex:1;padding:12px;border-radius:10px;background:#fff;border:1px solid #eee}

    /* gallery slider basic */
    .gallery{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px}
    .gallery img{height:160px;border-radius:10px;object-fit:cover;margin-right:8px}

    /* video & features grid */
    .video-features{display:grid;grid-template-columns:70% 30%;gap:16px;align-items:flex-start}
    .video-features iframe{width:100%;height:315px;border-radius:12px}
    .features ul{margin:0;padding-left:20px}

    /* footer */
    footer{background:var(--dark);color:#fff;padding:24px;text-align:center;margin-top:40px}

    /* responsive */
    @media (max-width:900px){
      .grid{grid-template-columns:repeat(2,1fr)}
      .video-features{grid-template-columns:1fr}
    }
    @media (max-width:520px){
      .grid{grid-template-columns:1fr}
      header img.logo{height:38px}
    }

    /* floating WA button */
    .wa-float{position:fixed;right:18px;bottom:18px;width:56px;height:56px;z-index:999}
    .wa-float img{width:100%;height:100%}

    .embed-responsive {
  position: relative;
  width: 100%;
  padding-bottom: 56.25%; /* rasio 16:9 */
  height: 0;
}
.embed-responsive iframe {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
}

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <img class="logo" src="logo.png" alt="MEG Cafe Logo">
        <div>
          <div style="font-weight:700">M E G</div>
          <div style="font-size:12px;color:var(--muted)">Cafe · Gym · Carwash</div>
        </div>
      </div>
      <nav>
        <a href="#menu">Menu</a> · <a href="#packages">Paket</a> · <a href="#gallery">Galeri</a> · <a href="#kontak">Kontak</a>
      </nav>
    </header>

    <!-- HERO Swiper -->
    <div class="swiper swiper-hero">
      <div class="swiper-wrapper" id="heroSlides"></div>
      <div class="swiper-pagination"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>

    <!-- Controls -->
    <section id="menu">
      <h2>Menu Kami</h2>
      <div class="controls">
        <input id="search" class="search" placeholder="Cari menu, kategori, atau tag..." />
        <select id="categoryFilter" class="filter">
          <option value="">Semua Kategori</option>
        </select>
        <select id="sort" class="filter">
          <option value="name">Urut: Nama</option>
          <option value="price_asc">Harga: Rendah → Tinggi</option>
          <option value="price_desc">Harga: Tinggi → Rendah</option>
        </select>
      </div>
      <div id="productsGrid" class="grid"></div>
    </section>

    <!-- Packages -->
    <section id="packages" style="margin-top:22px">
      <h2>Paket Gym & Carwash</h2>
      <div id="packagesList" class="packages"></div>
    </section>

    <!-- Gallery -->
    <section id="gallery" style="margin-top:22px">
      <h2>Galeri</h2>
      <div id="gallerySlider" class="gallery"></div>
    </section>

    <!-- Video + Features -->
    <section id="video" style="margin-top:22px">
      <h2>Video & Kelebihan Kami</h2>
      <div class="video-features">
        <div class="embed-responsive">
          <iframe id="ytframe" src="" frameborder="0" allowfullscreen></iframe>
        </div>
        <div class="features">
          <h3>Kelebihan Kami</h3>
          <ul>
            <li>Menu berbahan lokal dan sehat</li>
            <li>Gym lengkap & bersih, trainer profesional</li>
            <li>Proses cuci cepat dan hasil kinclong</li>
            <li>Booking online & pembayaran fleksibel</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Kontak -->
    <section id="kontak" style="margin-top:22px;margin-bottom:60px">
      <h2>Kontak & Lokasi</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div>
          <p id="address">Alamat: —</p>
          <p>Telp/WA: <a id="phoneLink" href="#">—</a></p>
          <p>Jam Operasional: <span id="openHours">07:00 - 22:00</span></p>
        </div>
        <div id="mapEmbed" class="embed-responsive"></div>
      </div>
    </section>
  </div>

  <!-- Floating WA button -->
  <a id="waFloat" class="wa-float" target="_blank" href="#">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
  </a>

  <footer>
    <p>© 2025 M E G Cafe · Gym · Carwash</p>
  </footer>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <!-- GLightbox JS -->
  <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

  <script>
    const APPS_SCRIPT_BASE = 'https://script.google.com/macros/s/AKfycbyA-J8A83fhg2hHCmoGZ6bvVSw5RHfbzy2Rs--rg-QEMpHvjbbuBj23HoKWz3Cf7Y5B/exec';
    const CACHE_TTL_MIN = 10;

    function cacheFetch(key, url) {
      const raw = localStorage.getItem(key);
      if (raw) {
        try {
          const obj = JSON.parse(raw);
          const ageMin = (Date.now() - obj.t)/60000;
          if (ageMin < CACHE_TTL_MIN && obj.data) return Promise.resolve(obj.data);
        } catch(e){}
      }
      return fetch(url).then(r => r.json()).then(j => {
        if (j.ok) {
          localStorage.setItem(key, JSON.stringify({t:Date.now(), data:j.data}));
          return j.data;
        } else return Promise.reject(j.error || 'fetch error');
      });
    }

    async function init() {
      try {
        const [settings, slider, products, packages, gallery] = await Promise.all([
          cacheFetch('meg_settings', APPS_SCRIPT_BASE + '?path=settings'),
          cacheFetch('meg_slider', APPS_SCRIPT_BASE + '?path=slider'),
          cacheFetch('meg_products', APPS_SCRIPT_BASE + '?path=products'),
          cacheFetch('meg_packages', APPS_SCRIPT_BASE + '?path=packages'),
          cacheFetch('meg_gallery', APPS_SCRIPT_BASE + '?path=gallery'),
        ]);

        if (settings) {
          if (settings.logo_url) document.querySelector('.logo').src = settings.logo_url;
          if (settings.phone_whatsapp) {
            const waHref = `https://wa.me/${settings.phone_whatsapp.replace(/\D/g,'')}`;
            document.getElementById('waFloat').href = waHref;
            document.getElementById('phoneLink').href = waHref;
            document.getElementById('phoneLink').textContent = settings.phone_whatsapp;
          }
          if (settings.google_maps_embed) {
            document.getElementById('mapEmbed').innerHTML = settings.google_maps_embed;
          } else {
            // fallback jika tidak ada di spreadsheet
            document.getElementById('mapEmbed').innerHTML = `<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1992.352141501076!2d112.3998654504567!3d-7.124982324081749!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e77f7df461e2a43%3A0x126fa1043952a986!2sMEG%20CARWASH%2C%20GYM%20AND%20CAFE!5e1!3m2!1sen!2sid!4v1756956511661!5m2!1sen!2sid" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
          }
          if (settings.youtube_embed) {
  let yurl = settings.youtube_embed;
  if (yurl.includes("watch?v=")) {
    // konversi watch?v= ke embed/
    const videoId = yurl.split("watch?v=")[1].split("&")[0];
    const listId = yurl.includes("list=") ? yurl.split("list=")[1].split("&")[0] : "";
    yurl = `https://www.youtube.com/embed/${videoId}${listId ? `?list=${listId}` : ""}`;
  }
  document.getElementById('ytframe').src = yurl;
}

          if (settings.business_address) document.getElementById('address').textContent = 'Alamat: ' + settings.business_address;
          if (settings.open_hours) document.getElementById('openHours').textContent = settings.open_hours;
        }

        // hero slider
        const heroBox = document.getElementById('heroSlides');
        (slider||[]).forEach(s => {
          const slide = document.createElement('div'); 
          slide.className = 'swiper-slide relative';
          slide.innerHTML = `
            <div class="left">
              <h1>${s.title||''}</h1>
              <p>${s.subtitle||''}</p>
              ${s.button_link ? `<a href="${s.button_link}" class="btn">${s.button_text||'Pesan Sekarang'}</a>` : ''}
            </div>
            <div class="right">
              ${s.image_url ? `<img src="${s.image_url}" alt="${s.title||''}">` : ''}
            </div>
            ${s.bg_image ? `<img src="${s.bg_image}" class="bg">` : `<div class="bg" style="background:${s.bg_color||'var(--primary)'}"></div>`}
          `;
          heroBox.appendChild(slide);
        });
        new Swiper(".swiper-hero", {
          loop:true,
          autoplay:{delay:4000},
          pagination:{el:".swiper-pagination", clickable:true},
          navigation:{nextEl:".swiper-button-next", prevEl:".swiper-button-prev"},
        });

        // products
        window.APP_PRODUCTS = products||[];
        renderProducts(products||[]);
        const cats = new Set((products||[]).map(p => p.category).filter(Boolean));
        const sel = document.getElementById('categoryFilter');
        cats.forEach(c => { const opt=document.createElement('option');opt.value=c;opt.textContent=c;sel.appendChild(opt); });

        // packages
        renderPackages(packages||[]);
        // gallery
        renderGallery(gallery||[]);

        // filter events
        document.getElementById('search').addEventListener('input', debounce(e=>applyFilter(),250));
        document.getElementById('categoryFilter').addEventListener('change', e=>applyFilter());
        document.getElementById('sort').addEventListener('change', e=>applyFilter());

        GLightbox({selector:'.glightbox'});
      } catch(err){ console.error('init error',err); }
    }

    function renderProducts(list) {
      const grid=document.getElementById('productsGrid');
      grid.innerHTML='';
      list.forEach(p=>{
        const card=document.createElement('div');card.className='card';
        card.innerHTML=`
          <a href="${p.image_url||'placeholder.jpg'}" class="glightbox" data-gallery="products">
            <img loading="lazy" src="${p.image_url||'placeholder.jpg'}" alt="${p.name||''}">
          </a>
          <div class="meta">
            <h4>${p.name||''}</h4>
            <div style="color:var(--muted);font-size:13px">${p.description||''}</div>
            <div class="price">${formatCurrency(p.price_original)}</div>
          </div>`;
        grid.appendChild(card);
      });
    }

    function renderPackages(list){
      const box=document.getElementById('packagesList'); box.innerHTML='';
      (list||[]).forEach(p=>{
        const el=document.createElement('div');el.className='pkg';
        el.innerHTML=`<h4>${p.name} <small style="color:var(--muted)">${p.type||''}</small></h4>
          <p style="color:var(--muted)">${p.description||''}</p>
          <div style="margin-top:8px;font-weight:700">${formatCurrency(p.price)}</div>`;
        box.appendChild(el);
      });
    }

    function renderGallery(list){
      const g=document.getElementById('gallerySlider'); g.innerHTML='';
      (list||[]).forEach(i=>{
        const img=document.createElement('img'); img.src=i.image_url; img.alt=i.caption||''; img.loading='lazy'; g.appendChild(img);
      });
    }

    function applyFilter(){
      const q=document.getElementById('search').value.trim().toLowerCase();
      const cat=document.getElementById('categoryFilter').value;
      const sort=document.getElementById('sort').value;
      let list=(window.APP_PRODUCTS||[]).filter(p=>{
        if(cat&&p.category!==cat) return false;
        if(!q) return true;
        return (p.name+' '+(p.description||'')+' '+(p.tags||'')).toLowerCase().includes(q);
      });
      if(sort==='price_asc') list.sort((a,b)=>(Number(a.price_original)||0)-(Number(b.price_original)||0));
      if(sort==='price_desc') list.sort((a,b)=>(Number(b.price_original)||0)-(Number(a.price_original)||0));
      if(sort==='name') list.sort((a,b)=>(a.name||'').localeCompare(b.name||''));
      renderProducts(list);
    }

    function formatCurrency(v){ if(!v) return ''; try{ return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR'}).format(Number(v)); }catch(e){ return v; } }
    function debounce(fn, wait){ let t; return(...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args),wait);} }
    init();
  </script>
</body>
</html>
